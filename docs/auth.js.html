<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>auth.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-auth.html">auth</a><ul class='methods'><li data-type='method'><a href="module-auth.html#.prelogin">prelogin</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">auth.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { post, postProcess } from './lib/fetch';
import Cookie from 'cookie';

/** @module auth */

/**
 * This is useful if you want to separate login into 2 steps.
 * It only requires an email or username, and if it exists,
 * it'll return a user object. You will still need to send a normal
 * login after this request to do the real login,
 * this is merely a "search by email/username".
 * Please note that this is heavily rate limited for security purposes.
 *
 * @param {Arguments} arguments
 * @param {String} arguments.login - The login (username OR email)
 * @promise Check of login exists
 * @resolve {Object} user information
 * @reject {Error} if user does not exists
 *
 * @example
 * import { auth } from 'playerme-js-api'
 *
 * auth
 *   .prelogin({ login: '&lt;login>' })
 *   .then((user) => user // do something with user info )
 *   .catch((error) => error // do something with error )
 */
export function prelogin(args = {}) {
  const { login } = args;

  if (!login) return false;

  return post('auth/pre-login', { login }).then(postProcess);
}

export function check(args = {}) {
  const { login, password } = args;

  if (!login || !password) return false;

  return post('auth/login', { login, password })
    .then((response) => {
      const cookies = Cookie.parse(response.headers.get('set-cookie'));

      // get subdomain / environemnt
      const matched = /^https?:\/\/([^\.]+)\./.exec(response.url);
      let sessionName = 'playerme_session';

      if (matched) {
        const subdomain = matched[1];
        sessionName = `${subdomain}_${sessionName}`;
      }

      const playermeSession = cookies[sessionName];

      return response.json().then((responseJSON) => {
        // inject session key into response result
        const resultWithSessionKey = {
          ...responseJSON,
          results: {
            ...responseJSON.results,
            playerme_session: playermeSession
          }
        };

        return Promise.resolve(resultWithSessionKey);
      });
    })
    .then(postProcess);
}

export function forgot(args = {}) {
  const { username } = args;

  if (!username) return false;

  return post('auth/forgot', { username })
    .then((response) => {
      return Promise.resolve(response);
    })
    .then(postProcess);
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.0-dev</a> on Wed Jan 20 2016 21:22:10 GMT+0800 (PHT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
